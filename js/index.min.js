function createTable(e){var t=["","마켓","현재가","전일대비","거래대금"],a=document.createElement("table");a.innerHTML='<colgroup><col width="25px"><col width="20%"/><col width="55px"/><col width="60px"/><col width="22%"/></colgroup>';for(var n=a.createTHead(),o=1;o<t.length;o++){var r=document.createElement("th");1==o?(r.colSpan=2,r.innerHTML=t[o]+' <i class="fas fa-exchange-alt"></i>'):o>1&&(r.innerHTML=t[o]+' <i class="fas fa-sort"></i>'),o>=3&&(r.style="text-align:right"),n.appendChild(r)}var c=["bookmark","market","trade_price","percent","acc_trade_price_24h"],l=document.createElement("table");l.innerHTML='<colgroup><col width="25px"><col width="20%"/><col width="55px"/><col width="60px"/><col width="22%"/></colgroup>',l.id="coinList",e.sort(function(e,t){return parseFloat(t.acc_trade_price_24h)-parseFloat(e.acc_trade_price_24h)});for(o=0;o<e.length;o++){tr=l.insertRow(-1),tr.id=e[o][c[1]];for(var i=JSON.parse(localStorage.getItem("coinBookmarkInfo"))||[],s="",m=0;m<t.length;m++){var d=tr.insertCell(-1);if(0==m){for(var g in i){if(i[g].market==e[o][c[1]]+"_bookmark"){s="checked";break}s=""}d.innerHTML='<div class="anim-icon star"><input class="bookmark" type="checkbox" id="'+e[o][c[1]]+'_bookmark"'+s+'/><label for="'+e[o][c[1]]+'_bookmark"></label></div>'}1==m&&(d.innerHTML='<strong class="'+e[o].market+'"></strong><span>'+e[o].market.split("-")[1]+"/"+e[o].market.split("-")[0]+"</span>"),3==m&&(d.innerHTML='<p class="signed_change_rate"></p><span class="signed_change_price"></span>'),d.className=c[m]}}document.getElementById("tableHeader").appendChild(a),document.getElementById("tableBody").appendChild(l)}function openUpbitPage(){var e=window.open("https://upbit.com/exchange?code=CRIX.UPBIT."+this.className,"_blank");e.focus()}function init(e){var t="";for(i=0;i<e.length;i++)"KRW"!=e[i].market.substr(0,3)&&(e.splice(i,1),i--);for(i=0;i<e.length;i++)t+=e[i].market,i<e.length-1&&(t+=",");globalData=e,fetch("https://api.upbit.com/v1/ticker?markets="+t).then(e=>e.json()).then(e=>createTable(e)).then(()=>getMarketName()).then(()=>customAddEventListener()).then(()=>webSocketConfig())}function getMarketName(){var e=localStorage.getItem("lang");null==e&&(localStorage.setItem("lang","korean_name"),e="korean_name");for(var t=0;t<globalData.length;t++)document.getElementById(globalData[t].market).getElementsByClassName(globalData[t].market)[0].innerHTML=globalData[t][e]}function setMarketName(){var e=localStorage.getItem("lang");"korean_name"==e?(e="english_name",localStorage.setItem("lang",e)):"english_name"==e&&(e="korean_name",localStorage.setItem("lang",e));for(var t=0;t<globalData.length;t++)document.getElementById(globalData[t].market).getElementsByClassName(globalData[t].market)[0].innerHTML=globalData[t][e]}function webSocketConfig(){var e="wss://api.upbit.com/websocket/v1";websocket=new WebSocket(e),websocket.binaryType="arraybuffer",websocket.onopen=function(e){onOpen(e)},websocket.onclose=function(e){onClose(e)},websocket.onmessage=function(e){onMessage(e)},websocket.onerror=function(e){onError(e)}}function onOpen(e){var t=[];for(i=0;i<globalData.length;i++)t.push(globalData[i].market);var a=[{ticket:"test"},{type:"ticker",codes:t}];a=JSON.stringify(a),websocket.send(a)}function onClose(){webSocketConfig()}function onMessage(e){var t=new TextDecoder("utf-8"),a=new Uint8Array(e.data),n=JSON.parse(t.decode(a)),o=document.getElementById(n.code).getElementsByClassName("trade_price")[0].textContent;document.getElementById(n.code).getElementsByClassName("trade_price")[0].innerHTML=n.trade_price.toLocaleString(),document.getElementById(n.code).getElementsByClassName("signed_change_rate")[0].innerHTML=getPercentNumber(n.signed_change_rate);var r=n.trade_price.toLocaleString();o!=r&&""!=o&&(o<r?(document.getElementById(n.code).getElementsByClassName("trade_price")[0].classList.remove("price-down"),document.getElementById(n.code).getElementsByClassName("trade_price")[0].classList.add("price-up")):o>r&&(document.getElementById(n.code).getElementsByClassName("trade_price")[0].classList.remove("price-up"),document.getElementById(n.code).getElementsByClassName("trade_price")[0].classList.add("price-down"))),document.getElementById(n.code).getElementsByClassName("signed_change_price")[0].innerHTML=getPlusMinusNumber(n.signed_change_price),document.getElementById(n.code).getElementsByClassName("acc_trade_price_24h")[0].innerHTML=getNumberUnit(n.acc_trade_price_24h),document.getElementById(n.code).className=n.change}function getPlusMinusNumber(e){return e>0?"+"+e.toLocaleString(navigator.language,{maximumFractionDigits:2}):e.toLocaleString(navigator.language,{maximumFractionDigits:2})}function getNumberUnit(e){var t=e.toLocaleString("ko-KR",{maximumFractionDigits:0});return t.length>=8&&(t=t.substring(0,t.length-8)+"백만"),t}function getPercentNumber(e){return e>0?"+"+(100*e).toFixed(2)+"%":(100*e).toFixed(2)+"%"}function onError(){webSocketConfig()}function searchCoin(){for(var e,t=document.getElementById("searchCoinInput"),a=t.value.toUpperCase(),n=cho_hangul(t.value.toUpperCase()),o=document.getElementById("coinList"),r=o.getElementsByTagName("tr"),c=document.getElementById("searchBookmark").checked,l=0;l<r.length;l++)for(var i=1;i<2;i++)if(td=r[l].getElementsByTagName("td")[1],e=r[l].getElementsByTagName("td")[0].getElementsByTagName("div")[0].getElementsByTagName("input")[0].checked,td)if(txtValue=td.textContent||td.innerText,txtChoValue=cho_hangul(td.textContent)||cho_hangul(td.innerText),txtValue.toUpperCase().indexOf(a)>-1||0==txtChoValue.toUpperCase().indexOf(n)&&isCho(a)){if(c&&e){r[l].style.display="";break}if(!c){r[l].style.display="";break}}else r[l].style.display="none"}function isCho(e){var t=/[ㄱ-ㅎ]/gi;return t.test(e)}function cho_hangul(e){for(cho=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],result="",i=0;i<e.length;i++)code=e.charCodeAt(i)-44032,code>-1&&code<11172?result+=cho[Math.floor(code/588)]:result+=e.charAt(i);return result}function onCheckBookmark(){stopColorEvent();var e=this;if(1==e.checked){var t=JSON.parse(localStorage.getItem("coinBookmarkInfo"))||[];t.push({market:e.id}),localStorage.setItem("coinBookmarkInfo",JSON.stringify(t))}else{t=JSON.parse(localStorage.getItem("coinBookmarkInfo"))||[];for(var a in t)t[a].market==e.id&&t.splice(a,1);localStorage.setItem("coinBookmarkInfo",JSON.stringify(t)),1==document.getElementById("searchBookmark").checked&&(document.getElementById(e.id.split("_")[0]).style.display="none")}}function onCheckBookmarkSearch(e){var t,a,n,o;if(document.getElementById("searchCoinInput").value="",document.getElementById("searchCoinInput"),t=document.getElementById("coinList"),a=t.getElementsByTagName("tr"),1==e.checked){for(o=0;o<a.length;o++)n=a[o].getElementsByTagName("td")[0].getElementsByTagName("div")[0].getElementsByTagName("input")[0].checked,a[o].style.display=1==n?"":"none";localStorage.setItem("bookmarkStatus",!0)}else{for(o=0;o<a.length;o++)a[o].style.display="";localStorage.removeItem("bookmarkStatus")}}function stopColorEvent(){for(var e=0;e<document.getElementsByClassName("trade_price").length;e++)document.getElementsByClassName("trade_price")[e].classList.remove("price-up"),document.getElementsByClassName("trade_price")[e].classList.remove("price-down")}function customAddEventListener(){function e(e){stopColorEvent(),m.ascending(e)}function t(e){stopColorEvent(),m.descending(e)}function a(a,n){for(var o=0;o<document.getElementsByTagName("th").length;o++)o!=n-1&&0!=o&&(document.getElementsByTagName("th")[o].getElementsByTagName("i")[0].className="fas fa-sort");a.getElementsByTagName("i")[0].classList.contains("fa-sort-up")?(t(n),a.getElementsByTagName("i")[0].classList.replace("fa-sort-up","fa-sort-down")):a.getElementsByTagName("i")[0].classList.contains("fa-sort-down")?(e(n),a.getElementsByTagName("i")[0].classList.replace("fa-sort-down","fa-sort-up")):(t(n),a.getElementsByTagName("i")[0].classList.replace("fa-sort","fa-sort-down"))}document.getElementById("searchBookmark").addEventListener("click",function(){onCheckBookmarkSearch(this)}),document.getElementById("searchCoinInput").addEventListener("keyup",searchCoin),document.getElementById("searchCoinInput").addEventListener("search",searchCoin);var n=document.querySelectorAll("input[type=checkbox][class=bookmark]");for(var o of n)o.addEventListener("change",onCheckBookmark);var r=document.querySelectorAll("strong");for(var c of r)c.addEventListener("click",openUpbitPage);var l=JSON.parse(localStorage.getItem("bookmarkStatus"))||!1;if(l){document.getElementById("searchBookmark").checked=!0;var i=new Event("click");document.getElementById("searchBookmark").dispatchEvent(i)}var s=document.getElementById("coinList"),m=replacement(s);document.getElementsByTagName("th")[0].addEventListener("click",function(){setMarketName()}),document.getElementsByTagName("th")[1].addEventListener("click",function(){var e=this;a(e,2)}),document.getElementsByTagName("th")[2].addEventListener("click",function(){var e=this;a(e,3)}),document.getElementsByTagName("th")[3].addEventListener("click",function(){var e=this;a(e,4)}),SimpleScrollbar.initEl(document.querySelector("#tableBody"))}function colorModePreview(e){1==e.checked?(localStorage.setItem("color-theme","dark"),document.getElementsByTagName("body")[0].classList="dark-preview"):(localStorage.setItem("color-theme","light"),document.getElementsByTagName("body")[0].classList="white-preview")}var globalData,url="https://api.upbit.com/v1/market/all";fetch(url).then(e=>e.json()).then(e=>init(e)),window.onload=function(){var e=localStorage.getItem("color-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",a=e||t;"dark"===a?(document.getElementsByClassName("btn-container")[0].innerHTML='<i class="fa fa-sun-o" aria-hidden="true"></i><label id="btn-color-mode-switch" class="switch btn-color-mode-switch"><input type="checkbox" name="color_mode" id="color_mode" value="1" checked/><label for="color_mode" class="btn-color-mode-switch-inner"></label></label><i class="fa fa-moon-o" aria-hidden="true"></i>',localStorage.setItem("color-theme","dark"),document.documentElement.setAttribute("color-theme","dark"),document.getElementsByTagName("body")[0].classList="dark-preview"):(document.getElementsByClassName("btn-container")[0].innerHTML='<i class="fa fa-sun-o" aria-hidden="true"></i><label id="btn-color-mode-switch" class="switch btn-color-mode-switch"><input type="checkbox" name="color_mode" id="color_mode" value="1" /><label for="color_mode" class="btn-color-mode-switch-inner"></label></label><i class="fa fa-moon-o" aria-hidden="true"></i>',localStorage.setItem("color-theme","light"),document.documentElement.setAttribute("color-theme","light"),document.getElementsByTagName("body")[0].classList="white-preview"),document.getElementById("color_mode").addEventListener("change",function(){colorModePreview(this)}),document.getElementById("searchCoinInput").focus()};